
/* Code automatically generated by Vult https://github.com/modlfo/vult */
#include "short_delay.h"

fix16_t Saturate_tanh_table_raw_c0(int index){
   return Saturate_tanh_table_c0[index];
}

fix16_t Saturate_tanh_table_raw_c1(int index){
   return Saturate_tanh_table_c1[index];
}

fix16_t Saturate_tanh_table_raw_c2(int index){
   return Saturate_tanh_table_c2[index];
}

fix16_t Saturate_tanh_table(fix16_t x){
   int index;
   index = int_clip(fix_to_int(fix_mul(0x50000 /* 5.000000 */,(x + 0x180000 /* 24.000000 */))),0,240);
   return (fix_wrap_array(Saturate_tanh_table_c0)[index] + fix_mul(x,(fix_wrap_array(Saturate_tanh_table_c1)[index] + fix_mul(fix_wrap_array(Saturate_tanh_table_c2)[index],x))));
}

fix16_t Saturate_process(fix16_t x){
   return Saturate_tanh_table(x);
}

void Saturate_noteOn(int note, int velocity, int channel){
}

void Saturate_noteOff(int note, int channel){
}

void Saturate_controlChange(int control, int value, int channel){
}

void Saturate_default(){
}

void Short_delay__ctx_type_0_init(Short_delay__ctx_type_0 &_output_){
   Short_delay__ctx_type_0 _ctx;
   _ctx.x4 = 0x0 /* 0.000000 */;
   _ctx.x3 = 0x0 /* 0.000000 */;
   _ctx.x2 = 0x0 /* 0.000000 */;
   _output_ = _ctx;
   return ;
}

void Short_delay_soft_init(Short_delay__ctx_type_0 &_output_){
   Short_delay__ctx_type_0_init(_output_);
   return ;
}

fix16_t Short_delay_soft(Short_delay__ctx_type_0 &_ctx, fix16_t x1){
   fix16_t o;
   o = ((x1 + _ctx.x2 + _ctx.x3 + _ctx.x4) >> 2);
   fix16_t _tmp_15_0;
   _tmp_15_0 = x1;
   fix16_t _tmp_15_1;
   _tmp_15_1 = _ctx.x2;
   fix16_t _tmp_15_2;
   _tmp_15_2 = _ctx.x3;
   _ctx.x2 = _tmp_15_0;
   _ctx.x3 = _tmp_15_1;
   _ctx.x4 = _tmp_15_2;
   return o;
}

void Short_delay__ctx_type_1_init(Short_delay__ctx_type_1 &_output_){
   Short_delay__ctx_type_1 _ctx;
   _ctx.write_pos = 0;
   ;
   _output_ = _ctx;
   return ;
}

void Short_delay_do_init(Short_delay__ctx_type_1 &_output_){
   Short_delay__ctx_type_1_init(_output_);
   return ;
}

fix16_t Short_delay_do(Short_delay__ctx_type_1 &_ctx, fix16_t x, fix16_t time, fix16_t feedback){
   time = fix_clip(time,0x0 /* 0.000000 */,0x10000 /* 1.000000 */);
   feedback = fix_clip(feedback,0x0 /* 0.000000 */,0x10000 /* 1.000000 */);
   fix16_t index_r;
   index_r = fix_mul(0x56220000 /* 22050.000000 */,time);
   int index_i;
   index_i = fix_to_int(fix_floor(index_r));
   int delta;
   delta = (_ctx.write_pos + (- index_i));
   int read_pos;
   if(delta < 0){
      read_pos = (22050 + delta);
   }
   else
   {
      read_pos = delta;
   }
   fix16_t decimal;
   decimal = (index_r + (- int_to_fix(index_i)));
   fix16_t x1;
   x1 = fix_get(_ctx.buffer,read_pos);
   fix16_t x2;
   x2 = fix_get(_ctx.buffer,((read_pos + 1) % 22050));
   fix16_t ret;
   ret = (fix_mul((x2 + (- x1)),decimal) + x1);
   _ctx.write_pos = ((_ctx.write_pos + 1) % 22050);
   fix_set(_ctx.buffer,_ctx.write_pos,Saturate_process((x + fix_mul(feedback,ret))));
   return ret;
}

void Short_delay__ctx_type_2_init(Short_delay__ctx_type_2 &_output_){
   Short_delay__ctx_type_2 _ctx;
   Short_delay__ctx_type_0_init(_ctx._inst9);
   Short_delay__ctx_type_1_init(_ctx._inst10);
   _output_ = _ctx;
   return ;
}

void Short_delay_process_init(Short_delay__ctx_type_2 &_output_){
   Short_delay__ctx_type_2_init(_output_);
   return ;
}

fix16_t Short_delay_process(Short_delay__ctx_type_2 &_ctx, fix16_t x, fix16_t time, fix16_t feedback){
   return Short_delay_do(_ctx._inst10,x,Short_delay_soft(_ctx._inst9,time),feedback);
}

void Short_delay_noteOn_init(Short_delay__ctx_type_2 &_output_){
   Short_delay__ctx_type_2_init(_output_);
   return ;
}

void Short_delay_noteOn(Short_delay__ctx_type_2 &_ctx, int note, int velocity, int channel){
}

void Short_delay_noteOff_init(Short_delay__ctx_type_2 &_output_){
   Short_delay__ctx_type_2_init(_output_);
   return ;
}

void Short_delay_noteOff(Short_delay__ctx_type_2 &_ctx, int note, int channel){
}

void Short_delay_controlChange_init(Short_delay__ctx_type_2 &_output_){
   Short_delay__ctx_type_2_init(_output_);
   return ;
}

void Short_delay_controlChange(Short_delay__ctx_type_2 &_ctx, int control, int value, int channel){
}

void Short_delay_default_init(Short_delay__ctx_type_2 &_output_){
   Short_delay__ctx_type_2_init(_output_);
   return ;
}

void Short_delay_default(Short_delay__ctx_type_2 &_ctx){
}




local this = {}
local ffi = require("ffi")
function this.ternary(cond,then_,else_) if cond then return then_ else return else_ end end
function this.eps()             return 1e-18; end
function this.pi()              return 3.1415926535897932384; end
function this.random()          return math.random(); end
function this.irandom()         return math.floor(math.random() * 4294967296); end
function this.clip(x,low,high)  return (this.ternary(x<low,low,this.ternary(x>high,high,x))); end
function this.real(x)           return x; end
function this.int(x)            local int_part,_ = math.modf(x) return int_part; end
function this.sin(x)            return math.sin(x); end
function this.cos(x)            return math.cos(x); end
function this.abs(x)            return math.abs(x); end
function this.exp(x)            return math.exp(x); end
function this.floor(x)          return math.floor(x); end
function this.tan(x)            return math.tan(x); end
function this.tanh(x)           return math.tanh(x); end
function this.sqrt(x)           return x; end
function this.set(a,i,v)        a[i+1]=v; end
function this.get(a,i)          return a[i+1]; end
function this.makeArray(size,v) local a = {}; for i=1,size do a[i]=v end return a; end
function this.wrap_array(a)     return a; end
local Saturate_table_c0 = {(-1.001609),(-0.998911),(-1.000504),(-0.999095),(-0.999347),(-0.999817),(-1.000446),(-1.000185),(-0.999827),(-1.000299),(-0.999976),(-0.999415),(-1.000233),(-1.000123),(-0.999987),(-1.000095),(-0.999994),(-0.999983),(-0.999937),(-0.999959),(-1.000009),(-1.000009),(-0.999995),(-1.000011),(-1.000004),(-1.000022),(-1.000003),(-0.999997),(-1.000011),(-1.000000),(-0.999994),(-0.999984),(-0.999962),(-0.999908),(-0.999782),(-0.999489),(-0.998814),(-0.997276),(-0.993832),(-0.986260),(-0.969999),(-0.936122),(-0.868484),(-0.741908),(-0.530066),(-0.245538),(-0.014461),0.016164,0.000000,(-0.016164),0.014461,0.245538,0.530066,0.741908,0.868484,0.936122,0.969999,0.986260,0.993832,0.997276,0.998814,0.999489,0.999782,0.999908,0.999962,0.999983,0.999997,0.999994,1.000002,1.000000,1.000001,1.000006,1.000031,1.000024,0.999974,1.000003,1.000039,1.000018,0.999934,1.000001,0.999930,0.999935,0.999894,1.000059,1.000233,0.999739,0.999976,1.000299,0.999566,1.000185,0.999900,1.000163,0.999448,0.999637,1.000504,1.000475,1.001286,1.000316};
local Saturate_table_c1 = {0.000022,0.000018,0.000002,(-0.000041),(-0.000009),(-0.000011),(-0.000003),0.000004,(-0.000003),0.000003,(-0.000001),(-0.000011),(-0.000009),(-0.000000),(-0.000008),(-0.000000),0.000005,0.000003,(-0.000002),0.000000,(-0.000001),0.000000,0.000002,(-0.000001),(-0.000000),0.000001,(-0.000000),0.000001,0.000000,0.000001,0.000001,0.000004,0.000009,0.000023,0.000058,0.000147,0.000366,0.000909,0.002243,0.005485,0.013273,0.031678,0.074129,0.168152,0.360779,0.693538,1.068319,1.132509,0.980082,1.132509,1.068319,0.693538,0.360779,0.168152,0.074129,0.031678,0.013273,0.005485,0.002243,0.000909,0.000366,0.000147,0.000058,0.000023,0.000009,0.000004,0.000001,0.000000,0.000000,(-0.000000),0.000001,(-0.000000),(-0.000000),(-0.000000),0.000001,(-0.000002),(-0.000000),(-0.000000),0.000001,0.000000,(-0.000001),(-0.000000),0.000004,(-0.000008),(-0.000009),0.000003,(-0.000001),(-0.000006),0.000006,0.000004,0.000007,0.000013,(-0.000031),(-0.000017),0.000002,(-0.000030),0.000017,(-0.000016)};
local Saturate_table_c2 = {(-0.000001),(-0.000001),0.000001,0.000001,(-0.000001),0.000000,(-0.000000),(-0.000000),(-0.000000),0.000001,(-0.000000),(-0.000000),0.000001,0.000000,0.000000,(-0.000000),(-0.000000),(-0.000000),0.000000,0.000000,0.000000,(-0.000000),(-0.000000),0.000000,0.000000,0.000000,0.000000,(-0.000000),0.000000,(-0.000000),0.000000,0.000000,0.000001,0.000001,0.000004,0.000011,0.000028,0.000076,0.000205,0.000552,0.001485,0.003985,0.010645,0.028103,0.071886,0.169162,0.321123,0.352016,0.000000,(-0.352016),(-0.321123),(-0.169162),(-0.071886),(-0.028103),(-0.010645),(-0.003985),(-0.001485),(-0.000552),(-0.000205),(-0.000076),(-0.000028),(-0.000011),(-0.000004),(-0.000001),(-0.000001),(-0.000000),(-0.000000),0.000000,(-0.000000),(-0.000000),(-0.000000),0.000000,(-0.000000),(-0.000000),0.000000,0.000000,(-0.000000),0.000000,0.000000,(-0.000000),0.000000,0.000000,0.000000,(-0.000000),(-0.000001),0.000000,0.000000,(-0.000000),0.000000,0.000000,0.000001,0.000000,0.000000,(-0.000001),(-0.000001),(-0.000002),(-0.000000),(-0.000000)};
function this.Saturate_table(x)
   local index = this.clip(this.int((2.000000 * (x + 24.000000))),0,96);
   return (Saturate_table_c0[index+1] + (x * (Saturate_table_c1[index+1] + (Saturate_table_c2[index+1] * x))));

end

function this.Saturate_process(_ctx,x)
   return this.Saturate_table(x);

end

function this.Saturate_noteOn(_ctx,note,velocity,channel)

end

function this.Saturate_noteOff(_ctx,note,channel)

end

function this.Saturate_controlChange(_ctx,control,value,channel)

end

function this.Saturate_default(_ctx)

end


function this.process(x) return this.Saturate_process(x) end
function this.noteOn(note,velocity,channel) return this.Saturate_noteOn(note,velocity,channel) end
function this.noteOff(note,channel) return this.Saturate_noteOff(note,channel) end
function this.controlChange(control,value,channel) return this.Saturate_controlChange(control,value,channel) end
function this.init() return this.Saturate_process_init() end
function this.default(ctx) return this.Saturate_default(ctx) end
this.config = { inputs = 1, outputs = 1, noteon_inputs = 3, noteoff_inputs = 2, controlchange_inputs = 3, is_active = false }
return this
